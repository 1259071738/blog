<div class="row">
    <div class="col-md-12"><a href="{{adminDir}}/file/add" class="btn btn-info">添加文件</a>
        <table class="table table-striped">
            <thead>
            <tr>
                <th>名称</th>
                <th>创建人</th>
                <th>类型</th>
                <th>创建时间</th>
                <th>操作</th>
            </tr>
            </thead>
            <tbody>
            {{#each files}}
            <tr>
                <td>
                    <div class="gallery-item">
                        <a href="{{url}}" target="_blank">
                        {{#compare type 'contains' 'image'}}

                                <img src="{{#if md_url}}{{md_url}}{{else}}{{url}}{{/if}}" title="{{name}}">

                        {{else}}

                                <span title="{{name}}" class="fa file-holder fa-file"></span>

                        {{/compare}}
                        </a>
                    </div>
                </td>
                <td>{{author.username}}
                </td>
                <td>{{type}}</td>
                <td>{{dateFormat created 'yyyy-MM-dd hh:mm:ss'}}</td>
                <td><!--<a href="{{../adminDir}}/file/{{id}}/edit" class="btn btn-default btn-xs">编辑</a>-->&nbsp;<a href="{{../adminDir}}/file/{{id}}/del" class="btn btn-danger btn-xs J_del">删除</a>
                </td>
            </tr>
         {{/each}}
            </tbody>
        </table>
        {{#if pageInfo}}
            {{#compare pageInfo.totalPage '>' 1}}
                <ul class="pagination">{{{pagination pageInfo}}}</ul>
            {{/compare}}
        {{/if}}
    </div>
</div>


<!-- Load these page level functions-->
{{#section 'scripts'}}
    <script type="text/javascript">
        var token = '{{token}}';
        Messenger.options = {
            extraClasses: 'messenger-fixed messenger-on-bottom messenger-on-right',
            theme: 'flat'
        };
        $(function () {
            $(document).on('click', '.J_del', function(e) {
                e.preventDefault();
                var $this = $(this);
                var $item = $this.closest('tr');
                var url = $this.attr('href');
                var messenger = Messenger().post("处理中...");
                $.post(url, {
                    _csrf: token
                }, function(json) {
                    if(json.success) {
                        messenger.update({
                            message: '删除成功',
                            hideAfter: 3,
                            type: 'success'
                        });
                        $item.remove();
                        if ($('tbody tr').length < 1) {
                            location.reload();
                        }
                    } else{
                        messenger.update({
                            message: '删除失败',
                            hideAfter: 3,
                            type: 'error'
                        });
                        //BootstrapDialog.alert('删除失败');
                    }
                });
            })
        })
    </script>
{{/section}}
